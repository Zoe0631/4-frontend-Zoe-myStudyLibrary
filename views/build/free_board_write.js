const BACKEND_URL="http://localhost:13414",FRONT_URL="http://localhost:37866",GET="GET",POST="POST",PATCH="PATCH",DELETE="DELETE",OK=200,CREATED=201,NO_CONTENT=204,BAD_REQUEST=400,UNAUTHORIZED=401,FORBIDDEN=403,NOT_FOUND=404,CONFLICT=409,INTERNAL_SERVER_ERROR=500,FAIL_FETCH="fail_fetch",REQUEST_SUCCESS="request_success",LOGIN_REQUIRED="login_required",LOGIN="login",ALREADY_LOGIN="already_login",LOGOUT="logout",SIGN_UP="sign_up",INVALID_BODY="invalid_body",PW_MISMATCHED="pw_mismatched",NEW_PW_CONFIRM_MISMATCHED="pw/pw_confirm_mismatched",ONLY_IMAGE="only_jpg,jpeg,gjf,png(upper_5MB)_format_can_be_uploaded",DUPLICATED_NICKNAME="duplicated_nickname",NOT_EXIST="not_exist",NO_COMMENT="no_comment",FAVORITE="favorite +1",CANCEL_FAVORITE="cancel_favorite",NOT_AUTHORIZATION="not_authorization",NO_REGISTERED_INFORMATION="no_registered_information",INFO="info",ERROR="error",SUCCESS="success",WARNING="warning",QUESTION="question",CHECK="check";async function getRecentBoard(){try{const t={mode:"cors",credentials:"include"},e=await fetch(`${BACKEND_URL}/board/get`,t),n=await e.json();return e.status===OK?n[0]:n}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function getEntireBoard(t){try{let e;const n={mode:"cors",credentials:"include"};e=void 0===t?await fetch(`${BACKEND_URL}/board/get/free-bulletin`,n):await fetch(`${BACKEND_URL}/board/get/free-bulletin?page=${t}`,n);return await e.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function getDetailBoard(t){try{const e={mode:"cors",credentials:"include"},n=await fetch(`${BACKEND_URL}/board/get/free-bulletin/${t}`,e),o=await n.json();return n.status===OK&&(o.state=REQUEST_SUCCESS),o}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function writePostRequest(t,e,n){try{const o=[],s=n.split("#");s.shift();for(let t of s){const e={content:t};o.push(e)}const a={mode:"cors",method:POST,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({category:"자유게시판",postTitle:t,postContent:e,tags:o})},i=await fetch(`${BACKEND_URL}/board/write`,a);if(201===i.status)return{state:REQUEST_SUCCESS};return await i.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function getPostRequest(t){try{const e={mode:"cors",method:GET,credentials:"include"},n=await fetch(`${BACKEND_URL}/board/write?boardIndex=${t}`,e),o=await n.json();return n.status===OK&&(o.state=REQUEST_SUCCESS),o}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function editPostRequest(t,e,n,o){try{const s=[],a=o.split("#");a.shift();for(let t of a){const e={content:t};s.push(e)}const i={mode:"cors",method:PATCH,credentials:"include",headers:{"Content-Type":"application/json;charset=utf-8","Access-Control-Allow-Headers":"Content-Type, Referrer-Policy","Referrer-Policy":"strict-origin-when-cross-origin"},body:JSON.stringify({category:"자유게시판",postTitle:e,postContent:n,tags:s})},r=await fetch(`${BACKEND_URL}/board/edit?boardIndex=${t}`,i);if(r.status===OK)return{state:REQUEST_SUCCESS};return r.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function deletePostRequest(t){try{const e={mode:"cors",method:DELETE,credentials:"include"},n=await fetch(`${BACKEND_URL}/board/delete?boardIndex=${t}`,e);if(204===n.status)return{state:REQUEST_SUCCESS};return await n.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function favoritePostRequest(t){try{const e={mode:"cors",method:PATCH,credentials:"include"},n=await fetch(`${BACKEND_URL}/board/like?boardIndex=${t}`,e);return n.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function getSearchBoard(t,e,n){try{let o;const s={mode:"cors",method:GET,credentials:"include"};o=void 0===n?await fetch(`${BACKEND_URL}/board/search/free-bulletin?searchOption=${t}&searchContent=${e}`,s):await fetch(`${BACKEND_URL}/board/search/free-bulletin?searchOption=${t}&searchContent=${e}&page=${n}`,s);return o.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function userPostRequest(t){try{let e;const n={mode:"cors",method:GET,credentials:"include"};e=void 0===t?await fetch(`${BACKEND_URL}/board/user`,n):await fetch(`${BACKEND_URL}/board/user?page=${t}`,n);return e.json()}catch(t){return console.log(`FETCH ERROR: ${t}`),{state:FAIL_FETCH}}}async function sweetAlert(t,e,n,o){let s=!1;if(t===INFO){const t=await Swal.fire({title:e,text:n,icon:"info",confirmButtonColor:"#ffa07a"});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}if(t===SUCCESS){const t=await Swal.fire({title:e,text:n,icon:"success",confirmButtonColor:"#ffa07a"});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}if(t===WARNING){if(o){const t=await Swal.fire({title:e,text:n,icon:"warning",confirmButtonColor:"#ffa07a",footer:o});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}{const t=await Swal.fire({title:e,text:n,icon:"warning",confirmButtonColor:"#ffa07a"});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}}if(t===ERROR){if(o){const t=await Swal.fire({title:e,text:n,icon:"error",confirmButtonColor:"#ffa07a",footer:o});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}{const t=await Swal.fire({title:e,text:n,icon:"error",confirmButtonColor:"#ffa07a"});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}}if(t===QUESTION){const t=await Swal.fire({title:e,text:n,icon:"question",confirmButtonColor:"#ffa07a"});return(t.isConfirmed||t.isDismissed)&&(s=!0),s}if(t===CHECK){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer)}}).fire({icon:n,title:e})}}let thisBoardIndex;async function checkTitleLength(t){const e=t.value.length;if(document.getElementsByClassName("container__title--length")[0].innerHTML=`(${e}/50)`,e>=50){const e=t.value.substring(0,49);t.value=e;const n=t.value.length;document.getElementsByClassName("container__title--length")[0].innerHTML=`(${n}/50)`,await sweetAlert(WARNING,"글자수 초과","제목은 50자 까지만 입력가능합니다.")}}async function checkContentLength(t){const e=t.value.length;if(document.getElementsByClassName("container__content--length")[0].innerHTML=`(${e}/5000)`,e>=5e3){const e=t.value.substring(0,4999);t.value=e;const n=t.value.length;document.getElementsByClassName("container__content--length")[0].innerHTML=`(${n}/5000)`,await sweetAlert(WARNING,"글자수 초과","내용은 5000자 까지만 입력가능합니다.")}}async function checkTagValidation(t){let e=!0;const n=t.value.split("#");if(n.shift(),0===t.value.length)return t.setCustomValidity(""),void t.reportValidity();if("#"!==t.value.substring(0,1))t.setCustomValidity("첫글자는 #으로 시작해주세요."),e=!1;else if(n.length>5)t.setCustomValidity(`태그는 최대 5개까지입니다. 현재 태그 개수: ${n.length}`),e=!1;else for(let o of n)if(o.length<2||o.length>8)t.setCustomValidity("하나의 태그는 2~8 글자 사이입니다."),e=!1;else{/^[가-힣]+$/.test(o)||(t.setCustomValidity("태그는 한글로만 작성해주세요(+ 가(o)ㄱ(x))"),e=!1)}e&&t.setCustomValidity(""),t.reportValidity()}async function writePost(t,e,n){const o=await writePostRequest(t,e,n);if(o.state===LOGIN_REQUIRED){await sweetAlert(WARNING,"로그인 필요","새 창에서 로그인 해주세요");window.open("/user/login")}if(o.state===REQUEST_SUCCESS){if(await sweetAlert(SUCCESS,"글 작성 성공","글 목록으로 이동합니다.")){const t="/board";location.href=t}}o.state!==LOGIN_REQUIRED&&o.state!==REQUEST_SUCCESS&&await sweetAlert(ERROR,"글 작성 실패","예상치 못한 에러입니다.",`서버 메시지: ${o.state}`)}async function checkRequest(){const t=new URLSearchParams(location.search);for(const[e,n]of t)if("boardIndex"===e){const t=Number(n);if(isNaN(t)){await sweetAlert(WARNING,"잘못된 접근입니다.","유효하지 않은 게시글 정보입니다..")&&(location.href="/board")}else{thisBoardIndex=t;const e=await getPostRequest(n);if(e.state===LOGIN_REQUIRED){if(await sweetAlert(WARNING,"로그인 필요","로그인이 필요한 기능입니다.")){const t="/user/login";location.href=t}}else if(e.state===NOT_EXIST){await sweetAlert(WARNING,"존재하지 않는 게시글입니다.","삭제되거나 존재하지 않는 게시글입니다.")&&(location.href="/board")}else if(e.state===REQUEST_SUCCESS){document.getElementsByClassName("freeBoard__title")[0].innerHTML="자유게시판 - 글 수정";const t=document.getElementsByClassName("container__write--title")[0],n=document.getElementsByClassName("container__write--content")[0];t.value=e.dataOfBoard.postTitle,n.value=e.dataOfBoard.postContent,await checkTitleLength(t),await checkContentLength(n);let o="";for(let t of e.dataOfTag)o=`${o}#${t.tag}`;document.getElementsByClassName("container__write--tag")[0].value=o,document.getElementsByClassName("container__write")[0].setAttribute("onsubmit","editPost(thisBoardIndex,document.getElementsByName('postTitle')[0].value,document.getElementsByName('postContent')[0].value,document.getElementsByName('tags')[0].value);return false")}else await sweetAlert(ERROR,"기존 게시글 정보 불러오기 실패","예상치 못한 에러입니다.",`서버 메시지: ${e.state}`)}}}async function editPost(t,e,n,o){const s=await editPostRequest(t,e,n,o);if(s.state===LOGIN_REQUIRED){await sweetAlert(WARNING,"로그인 필요","로그인 해주세요")&&(location.href="/user/login")}else if(s.state===NOT_EXIST){await sweetAlert(WARNING,"존재하지 않는 게시글","게시글 목록으로 이동")&&(location.href="/board")}else if(s.state===REQUEST_SUCCESS){await sweetAlert(SUCCESS,"글 수정 성공","해당 게시글로 이동합니다.")&&(location.href=`/board/${t}`)}else await sweetAlert(ERROR,"글 작성 실패","예상치 못한 에러입니다.",`서버 메시지: ${s.state}`)}async function lifeCycle(){await checkRequest()}lifeCycle();